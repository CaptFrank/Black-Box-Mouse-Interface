/*
 * USB_Sender_Utils.cpp
 *
 *  Created on: Aug 30, 2013
 *      Author: francispapineau
 */

#include "../../System_Defines/Main_Defines.h"
#include "USB_Sender_Utils.h"

uint8_t ACMAsyncOper::OnInit(ACM *pacm){
  uint8_t rcode = 0;

  // Set DTR=1 and RTS=1:
  rcode = pacm->SetControlLineState(3);

  if (rcode) {
	error((void*) __LINE__, (void*) __func__);
	return rcode;
  }

  lc.bCharFormat = 0;
  lc.bParityType = 0;
  lc.bDataBits = 8;

  rcode = pacm->SetLineCoding(&lc);

  if (rcode)
	error((void*) __LINE__, (void*) __func__);
  	return rcode;
}

bool send_frame(int len, uint8_t* frame){
  uint8_t rcode;

  if (DEBUG) {
    print_frame("-> ", len, frame, "\r\n");
  }

  rcode = Acm.SndData(len, frame);
  if (rcode) {
    ErrorMessage<uint8_t>(PSTR("SndData"), rcode);
    return false;
  }
  else {
    return true;
  }
}


